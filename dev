#!/usr/bin/env bash

# Development script with file watching
# Usage: <runner> dev [--db-url <url>] [--port <port>], where <runner> is one of:
#	./tools/_run.sh (To run the command directly from the project root)
#	airkeys (alias of the above, if setup.sh has been run to create it)

# Setup cleanup on exit
cleanup() { kill $WATCHEXEC_PID 2>/dev/null || true; exit 0; }
trap cleanup SIGINT SIGTERM

# Watch for changes using watchexec with restart and bell flags
watchexec -r -w source/ -- "./tools/build --dest=./dist --db-reset-ok $* && ./tools/serve $*" &
WATCHEXEC_PID=$!

wait $WATCHEXEC_PID
