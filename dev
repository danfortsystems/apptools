#!/usr/bin/env bash

# Development script with file watching
# Usage: project dev [--db-url <url>] [--port <port>] 
# where "project" is the apptools dispatcher available when AppTools has been installed


# Setup cleanup on exit
cleanup() { kill $WATCHEXEC_PID 2>/dev/null || true; exit 0; }
trap cleanup SIGINT SIGTERM

# Watch for changes using watchexec with restart and bell flags
watchexec -r -w source/ -- "./build --dest=./dist --db-reset-ok $* && ./start $*" &
WATCHEXEC_PID=$!

wait $WATCHEXEC_PID
