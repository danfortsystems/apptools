AppTools: Specifications
-------------------------------------------------------
Updated: January 29, 2026
Version: 0.1.0

OVERVIEW
	AppTools is a set of Bash-based command-line tools for orchestrating common development and project management tasks within the monorepo. It replaces project-specific shell scripts with a unified toolset, ensuring consistency and simplifying maintenance.

	The tools operate as simple Bash scripts that respond to environment variables to determine their behavior for each target project. This lightweight approach provides flexibility without requiring complex configuration files.

	This document provides the technical specifications for the AppTools.

SYSTEM ARCHITECTURE

	Components
		- Main Entry Point: The `project` script that serves as a dispatcher to other tools.
		- Core Tools: Individual Bash scripts for specific tasks (deps, build, test, serve, dev, deploy, db).
		- Environment Handler: The `_env.sh` script loads variables from a `.env` file into the environment.
		- Utility Functions: Shared functions in `_utils.sh` for consistent logging and error handling.
		- Container Management: Built-in Podman container management for local services.

	Prerequisites
		- Bash shell
		- Podman (for local container management)
		- Standard Unix/Linux tools

	Execution Context
		The tools are designed to be executed from the root directory of a target project. They implicitly determine the current project context by reading a `.env` file (if present) and using environment variables to control their behavior. All operations are relative to the current working directory.

COMMAND LINE INTERFACE

	Main Command: `project`
		Usage: project <action> [arguments]

		The `project` script is a dispatcher that:
		1. Loads environment variables from `.env` file (if present)
		2. Calls the appropriate script in `build/` directory
		3. Manages logging with timestamps
		4. Handles output formatting and error reporting

	Available Actions:

		`deps`
			Usage: project deps [--reset <targets>]

			Environment Variables:
				- DATABASE_URL: Controls PostgreSQL database reset/install (if set, processes Postgres)
				- DB_PATH: Controls SQLite database reset/install (if set, processes SQLite)
				- OBJECT_STORAGE_BUCKET: Controls MinIO bucket creation
				- MSG_FROM_EMAIL_ADDRESS: Controls MailHog per-project isolation
				- PLAYWRIGHT_BROWSERS_PATH: Controls Playwright browser installation

			Behavior:
				- Manages dependencies based on environment variables
				- Valid targets: js (Node.js packages), db (databases), containers (Podman), browsers (Playwright)
				- If no --reset specified, installs all available dependencies
				- If --reset specified, resets specified targets then installs all

			Examples:
				project deps								# Install all available dependencies
				project deps --reset						# Reset and reinstall all
				project deps --reset db,js					# Reset db and js, install others

		`build`
			Usage: project build [--db-reset-ok]

			Environment Variables:
				- DATABASE_URL: PostgreSQL connection URL
				- DB_PATH: SQLite database file path

			Behavior:
				- Processes SQL schema files to generate database initialization scripts
				- Compares existing schema with DDL scripts to detect changes
				- Generates db.init.sql always
				- Generates db.migrate.sql if schema differences detected
				- --db-reset-ok flag allows database reset when no migration script exists

		`test`
			Usage: project test [--only <types>] [--no-db-create] [--fast]

			Environment Variables:
				- DATABASE_URL: For test database setup
				- PLAYWRIGHT_BROWSERS_PATH: For browser testing

			Behavior:
				- Manages test environment including database setup
				- Runs different test types based on configuration
				- Cleans up resources after completion

		`dev`
			Usage: project dev [options...]

			Behavior:
				- Starts development server with file watching
				- Automatically rebuilds and restarts on file changes
				- Inherits all options from serve command

		`serve`
			Usage: project serve [--port <port>] [--db-url <url>]

			Environment Variables:
				- DATABASE_URL: Database connection
				- OBJECT_STORAGE_BUCKET: MinIO bucket name
				- MSG_FROM_EMAIL_ADDRESS: MailHog isolation

			Behavior:
				- Starts the application server
				- Manages required services (containers)
				- Handles port conflicts

		`deploy`
			Usage: project deploy

			Behavior:
				- Handles deployment process
				- May use environment-specific configurations

		`db`
			Usage: project db <command> [options]

			Behavior:
				- Provides database-specific operations
				- May include migrations, backups, etc.

ENVIRONMENT VARIABLES

	Core Variables:
		- NODE_ENV: Build/execute environment (dev or prod), default: dev

	Database Variables:
		- DATABASE_URL: PostgreSQL connection string (format: postgres://user:pass@host:port/dbname)
		- DB_PATH: SQLite database file path

	Container Service Variables:
		- OBJECT_STORAGE_BUCKET: MinIO bucket name for project isolation
		- MSG_FROM_EMAIL_ADDRESS: Email address for MailHog per-project isolation
		- SMS_* (proposed): SMS service configuration variables

	Testing Variables:
		- PLAYWRIGHT_BROWSERS_PATH: Path for Playwright browser installations

	Container Management:
		- Container names are generic (minio, mailhog) for sharing across projects
		- Isolation achieved through environment variables
		- Containers are started/stopped based on presence of relevant env vars

DEVELOPMENT

	Installation
		- Tools are copied to ~/.local/bin/apptools/
		- PATH is updated in ~/.bashrc and ~/.zshrc
		- One-liner installer available via curl script

	Deployment
		- Simple file-based deployment via _deploy script
		- No build process required (scripts are Bash)
		- Tools remain executable without installation

	FUTURE ENHANCEMENTS

		Potential SMS Integration:
			- SMS_* environment variables for SMS testing configuration
			- Container-based SMS gateway or integration with Twilio
			- Environment variable control similar to other services